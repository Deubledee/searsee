<link rel="import" href="routes/page-home.html">
<link rel="import" href="youtube/components/validate-input.html">
<link rel="import" href="imports.html">
<dom-module id="app-shell">
  <template>
    <style>
      :host {
        --app-primary-color: #4285f4;
        --app-secondary-color: black;
        display: block;
      }

      app-drawer-layout:not([narrow]) [drawer-toggle] {
        display: none;
      }

      app-toolbar {
        color: #fff;
        background-color: var(--app-primary-color);
       /* padding: 2px 6px;*/
      }

      app-toolbar ul {
        width: 100%;
        margin-bottom: 20px;
        padding: 10px 15px;
      }

      app-toolbar li {
        width: 49%;
        float: left;
        position: relative;
        display: block;
        margin-bottom: -1px;
      }

      app-header paper-icon-button {
        --paper-icon-button-ink-color: white;
      }

      app-header {}

      paper-input {
        background-color: #6e9feb7d;
        margin-left: 2px;
      }

      app-drawer {
        z-index: 1
      }

      .drawer-list {
        margin: 0 20px;
      }

      .drawer-list a {
        display: block;
        padding: 0 16px;
        text-decoration: none;
        color: var(--app-secondary-color);
        line-height: 40px;
      }

      .drawer-list a.iron-selected {
        color: black;
        font-weight: bold;
      }

      paper-input.right {
        position: absolute;
        right: 4em;
        background-color: rgba(161, 226, 238, 0.29);
      }

      paper-icon-button.right {
        position: absolute;
        right: 10px;
        ;
      }

      paper-icon-button.left {
        left: 10px;
      }
    </style>

    <app-location route="{{route}}" url-space-regex="^[[rootPath]]"></app-location>
    <app-route route="{{route}}" pattern="[[rootPath]]:page" data="{{routeData}}" tail="{{subroute}}" queryParams="{{queryParams}}"></app-route>

    <!-- Drawer content -->
    <!-- Drawer content -->
    <app-drawer id="drawer" slot="drawer" swipe-open="[[narrow]]">
      <app-toolbar>Menu</app-toolbar>

      <validate-input label="Search pages" value="{{routeData.page}}" jason-data="[[jasonData]]"></validate-input>

      <iron-selector selected="[[page]]" attr-for-selected="name" class="drawer-list" role="navigation">
        <a name="home" href="/home" on-click="_drToggle">home</a>
        <a name="login" href="/login" on-click="_drToggle">login</a>
        <a name="youtube" href="/youtube/search" on-click="_drToggle">youtube</a>
      </iron-selector>
    </app-drawer>
    <app-header-layout>
      <app-header slot="header" effects="waterfall" condenses reveals>

        <app-toolbar id="toolbar">
          <paper-icon-button id="pageButton" hidden class="left" icon="menu" on-click="_innerDrToggle"></paper-icon-button>
          <paper-input id="val" class="right" label="Search all" value="{{someData}}"></paper-input>
          <paper-icon-button class="right" icon="menu" on-click="_drToggle"></paper-icon-button>
        </app-toolbar>

      </app-header>
      <iron-pages selected="{{page}}" attr-for-selected="name" fallback-selection="view404" role="main">
        <page-home name="home"></page-home>
        <page-login name="login"></page-login>
        <my-youtube id="youtube" name="youtube" dataq="{{someData}}" resize="[[resise]]"></my-youtube>
        <page-view404 name="view404"></page-view404>
      </iron-pages>
    </app-header-layout>
  </template>
  <script>
    class AppShell extends Polymer.Element {
      static get is() {
        return 'app-shell';
      }
      static get properties() {
        return {
          page: {
            type: String,
            reflectToAttribute: true,
            observer: '_pageChanged',
            notify: true
          },
          resise: {
            type: Boolean,
            notify: true
          },
          queryParams: {
            type: Object,
          },
          routeData: Object,
          subroute: Object,
          rootPath: {
            type: String,
            value: "/"
          },
          tail: {
            type: String,
            notify: true
          },
          someData: {
            type: String,
            value: "",
            notify: true
          },
          jsonData: {
            type: Object,
            notify: true,
            value: function () {
              return {
                searches: [
                  "youtube",
                  "searchYouTube",
                  "video",
                  "home",
                  "login"
                ],
                alter: {
                  "searchyoutube": {
                    value: "searchYouTube"
                  },
                  "search": {
                    op: "youtube",
                    value: "searchYouTube"
                  },
                  "v√≠deo": {
                    value: "video"
                  }
                }
              }
            }
          }
        };
      }

      static get observers() {
        return [
          '_routePageChanged(routeData.page)',
        ];
      }

      connectedCallback() {
        super.connectedCallback();
        if (window.performance && performance.mark)
          performance.mark('app-shell.connected');
      }

      ready() {
        super.ready()
        this._resize()
        window.onresize = (function (event) {
          this._resize()
        }).bind(this)
        window.onbeforeunload = function (e) {
          return "Do you really want to leave our brilliant application?"
          //if we return nothing here (just calling return;) then there will be no pop-up question at all
          //return;
        };

      }
      _resize(likeHome) {
        let elem = this.$.val, val, val2
        val = (parseFloat(window.innerWidth) / 2.5) + "px"
        this.$.pageButton.hidden = true
        if (this.routeData.page === "video") {
          this.set('resise', true)
          this.set('resise', false)
        }
        if (window.innerWidth <= 640) {
          val = (window.innerWidth - 150) + "px"
        }
        if (this.routeData.page !== "searsee.github.io" && this.routeData.page !== "") {
          val2 = (window.innerWidth - (this.$.drawer.getWidth() + 50)) + "px"
          if (window.innerWidth <= 640) {
            this.$.pageButton.hidden = false
            val2 = this.$.toolbar.style.width = (window.innerWidth - 5) + "px"
          }

          this.$.toolbar.style.width = val2
          this.$.toolbar.style.float = "right"
          // console.log(this.routeData.page, this.$.toolbar.style.width, (window.innerWidth - (this.$.drawer.getWidth() + 30)))

        }
        if (likeHome || this.routeData.page === "home") {
          this.$.toolbar.style.width = (window.innerWidth - 10) + "px"
          // console.log(this.routeData.page, this.$.toolbar.style.width, window.innerWidth, this.$.drawer.getWidth())
        }
        elem.style.width = val
      }

      _drToggle() {
        this.$.drawer.toggle()
      }
      _innerDrToggle() {
        if ("drawer" in this.$[this.page].$) {
          if (window.innerWidth <= 640)
            this.$[this.page].$.drawer.style.top = "-56px"
          this.$[this.page].$.drawer.toggle()
        }
      }
      _routePageChanged(page) {
        let loadPage
        if (page === "searsee.github.io") {
          this.page = "home"
          this._resize("likeHome")
          return
        }
        console.log("return")

        loadPage = this.subroute.prefix.split("/")[1] || "home"
    
        this.page = loadPage //|| Polymer.path.
        this._resize()
      }
      _pageChanged(page) {
        console.log(page)
        var resolvedPageUrl
        resolvedPageUrl = page === "login" || page === "home" || page === "view404" ? this.resolveUrl('routes/page-' + page + '.html') :
          this.resolveUrl('routes/' + page + '/page-' + page + '.html')
        Polymer.importHref(
          resolvedPageUrl,
          null,
          null,
          true);
      }
    }

    window.customElements.define(AppShell.is, AppShell);
  </script>
</dom-module>
