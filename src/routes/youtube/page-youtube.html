<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt-->

<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../../bower_components/google-signin/google-signin.html">
<link rel="import" href="../../../bower_components/google-signin/google-signin-aware.html">
<link rel="import" href="../../../bower_components/app-route/app-location.html">
<link rel="import" href="../../../bower_components/app-route/app-route.html">
<link rel="import" href="../../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../../../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../styles/shared-styles.html">
<dom-module id="my-youtube">
  <template id="page-template">
    <custom-style>
      <style>
        :host {
          --app-primary-color: rgb(207, 29, 23);
          --app-secondary-color: black;
          --app-third-color: rgb(66, 133, 244);
          display: block;
        }

        app-drawer-layout:not([narrow]) [drawer-toggle] {
          display: none;
        }

        iron-pages {
          transition: transform 0.3s;
        }

        page-search {
          display: block;
          padding: 4px 1px 1px 3px;
        }

        app-drawer {
          --app-drawer-content-container: {
            background-color: rgb(253, 250, 250);
            ;
          }
        }

        app-drawer.lower {
          top: 4em;
          /* position: relative; */
        }

        app-toolbar {
          color: var(--app-third-color);
          background-color: var(--app-primary-color);
          font-size: 2em;
          text-shadow: 1px 1px 0px yellow;
        }

        app-toolbar ul {
          width: 100%;
          margin-bottom: 20px;
          padding: 10px 15px;
        }

        app-toolbar li {
          width: 49%;
          float: left;
          position: relative;
          display: block;
          margin-bottom: -1px;
        }

        app-header paper-icon-button {
          --paper-icon-button-ink-color: white;
        }

        paper-input {
          background-color: #6e9feb7d;
          margin-left: 2px;
        }

        paper-input#val {
          background-color: #0000;
          margin-left: 2px;
        }

        app-drawer {
          z-index: 1;
          --app-drawer-content-container: {
            background-color: #adc2d28c;
          }
        }

        .drawer-list {
          margin: 0 20px;
        }

        .drawer-list a {
          display: block;
          padding: 0 16px;
          text-decoration: none;
          color: var(--app-secondary-color);
          line-height: 40px;
        }

        .drawer-list a.iron-selected {
          color: black;
          font-weight: bold;
        }

        [main-title] {
          font-weight: lighter;
          margin-left: 108px;
        }

        [condensed-title] {
          font-weight: lighter;
          margin-left: 30px;
          overflow: hidden;
          text-overflow: ellipsis;
        }

        [condensed-title] i {
          font-weight: 100;
          font-style: normal;
        }

        @media (max-width: 640px) {
          [main-title] {
            margin-left: 50px;
            font-size: 30px;
          }
          [condensed-title] {
            font-size: 15px;
          }
          app-drawer {
            --app-drawer-content-container: {
              position: absolute;
              top: -64px;
            }
          }
        }

        :host([video-page-active]) {
          overflow: hidden;
        }

        :host([video-page-active]) iron-pages {
          transform: translateY(-170px);
        }
      </style>
    </custom-style>

    <app-location route="{{route}}"></app-location>
    <app-route route="{{route}}" pattern="/:page" data="{{data}}" tail="{{routeTail}}" query-params="{{query}}">
    </app-route>
    <!--*app-route /youtube/ - app link -->
    <app-route route="{{route}}" pattern="/youtube/:app" data="{{pageData}}" tail="{{pageTail}}" query-params="{{pageQuery}}"
      active="{{pageActive}}">
    </app-route>
    <!--app-route /videos/-->
    <app-route route="{{route}}" pattern="/videos/:vid" data="{{videoRouteData}}" tail="{{videoTail}}" query-params="{{VideoQuery}}">
    </app-route>
    <app-drawer-layout>
      <app-drawer id="drawer" slot="drawer">
        <!--google-signin class="right" brand="google" client-id="637872775110-m6bs42r7jrr0kuq4vkpqig7qf60dgpl0.apps.googleusercontent.com">
                <b hidden id="not-signed-in">Not signed in!</b>
              </google-signin-->
        <youtube-toolbar collapsed$="{{videoPageActive}}">
          <youtube-search route="[[pageTail]]" Label="asd" hide="true" search="[[dataq]]" video-data="{{videoData}}"></youtube-search>
        </youtube-toolbar>

        <validate-input label="Search pages" value="{{routeTail.path}}">
        </validate-input>
        <iron-selector selected="[[page]]" attr-for-selected="name" class="drawer-list" role="navigation">
          <a name="home" href="/youtube/search/" on-click="_drToggle">search</a>
          <a name="login" href="/youtube/channel/" on-click="_drToggle">channel</a>
          <a name="youtube" href="/youtube/profile/" on-click="_drToggle">profile</a>
        </iron-selector>
      </app-drawer>

      <iron-pages selected="[[page]]" attr-for-selected="name" fallback-selection="view404" role="main">
        <page-video name="video" id="video" route="{{route}}" resize="[[resize]]" active="{{pageActive}}">
        </page-video>
        <page-search name="search" id="search" route="{{routeTail}}" items="{{videos}}">
        </page-search>
        <page-view404 name="view404"></page-view404>
      </iron-pages>
      </div>
      <!--code>google-signin-offline</code> events:
    <span>{{offlineCode}}</span>
    </p>
    <p>Only display "not signed in" element after auth state is initialized (avoid flickering):
      <b hidden id="not-signed-in">Not signed in!</b>
    </p>
    <p>
      <button on-click="disconnect">Disconnect to start over</button>
    </p-->
      <!--google-signin-aware scopes="{{scope}}" openid-prompt="{{openidPromptValue}}" initialized="{{initialized}}" signed-in="{{signedIn}}"
      offline="{{offline}}" is-authorized="{{isAuthorized}}" need-additional-auth="{{needAdditionalAuth}}" on-google-signin-aware-error="handleSignInError"
      on-google-signin-aware-success="handleSignIn" on-google-signin-offline-success="handleOffline" on-google-signin-aware-signed-out="handleSignOut"
      on-signed-in-changed="handleStateChange" on-initialized-changed="handleStateChange">
    </google-signin-aware-->
  </template>
  <script>
    class pageYoutube extends Polymer.Element {
      static get is() {
        return 'my-youtube';
      }

      constructor() {
        super();
      }

      static get properties() {
        return {
          page: {
            type: String,
            reflectToAttribute: true,
            observer: '_pageChanged',
            notify: true
          },
          route: {
            type: Object,
            notify: true
          },
          data: {
            type: Object,
            notify: true
          },
          routeTail: {
            type: Object,
            notify: true
          },
          pageActive: {
            type: Boolean,
            reflectToAttribute: true,
            notify: true
          },
          rootPath: {
            type: String,
            value: "/"
          },
          pageTail: {
            type: Object,
            notify: true
          },
          pageQuery: {
            type: Object,
            notify: true,
            //observer: 'log'
          },
          pageData: {
            type: Object,
            notify: true,
            observer: '_routePageChanged'
          },
          searchTail: {
            type: Object,
            notify: true
          },
          searchQuery: {
            type: Object,
            notify: true,
            observer: 'logsh'
          },
          searchData: {
            type: Object,
            notify: true
          },
          channelquery: {
            type: Object,
            notify: true,
            observer: 'logch'
          },
          channelData: {
            type: Object,
            notify: true
          },
          channelTail: {
            type: Object,
            notify: true
          },
          videoTail: {
            type: Object,
            notify: true
          },
          videoquery: {
            type: Object,
            notify: true
          },
          videoRouteData: {
            type: Object,
            notify: true
          },
          newCategory: {
            type: String
          },
          videoData: {
            type: Object,
            observer: '_videoDataChanged',
          },
          videos: {
            type: Array,
            value: function () {
              return [];
            },
            notify: true
          },
          resize: {
            type: Boolean,
            notify: true,
            observer: '_messenger'
          },
          dataq: {
            type: String,
            value: "zen",
            notify: true
          },
          time: {
            type: String,
            notify: true
          },
          data: {
            type: Object
          },
          datavid: {
            type: Object
          },
          query: {
            type: Object,
            // observer: 'log'
          }
        }
      };

      static get observers() {
        /* return [
           '_routePageChanged(data.page)',
         ];*/
      }
      _drToggle() {
        this.$.drawer.toggle()        
      }
      _videoDataChanged(data) {
        var allVideos = [];
        var that = this;
        if (data)
          // console.log(data)
          data.items.forEach(function (videoItem) {
            var youtubeVideo = {
              id: videoItem.id.videoId,
              title: videoItem.snippet.title,
              shortTitle: that.removeBadCharacters(videoItem.snippet.title.toLocaleLowerCase()) + " ...!!",
              thumbnail: videoItem.snippet.thumbnails.medium.url,
              channelTitle: videoItem.snippet.channelTitle.toLocaleLowerCase(),
              channelId: videoItem.snippet.channelId,
              videoItem: videoItem
            };

            allVideos.push(youtubeVideo);
          })
        this.set('videos', allVideos);
      }

      removeBadCharacters(char) {
        let arr = char.split(" ")
        let arr2 = []
        arr.map(item => {
          arr2.push(item.match(/\w[A-z]*/))
        })
        return arr2.join(" ")
      }

      attached() {
        // If we do not have an initial URL, we redirect to /search
        if (!this.route || !this.route.path) {
          this.set('route.path', 'yotube/search/');
        }
      }
      _messenger(data) {
        this.$.video.resize = data
      }

      _routePageChanged(page) {
        // console.log("page.app", page.app)
        this.page = page.app !== "youtube" ? page.app : "search"
        //console.log("pageData.app", this.pageData.app)       
      }

      _pageChanged(page) {
        var resolvedPageUrl = this.resolveUrl('page-' + page + '.html');
        Polymer.importHref(
          resolvedPageUrl,
          null,
          null,
          true);
      }

    }
    window.customElements.define(pageYoutube.is, pageYoutube);
  </script>
</dom-module>