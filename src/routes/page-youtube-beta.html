<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../bower_components/google-signin/google-signin.html">
<link rel="import" href="../../bower_components/google-signin/google-signin-aware.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../styles/shared-styles.html">
<link rel="import" href="../components/youtube-search.html">
<link rel="import" href="../components/youtube-channel.html">
<link rel="import" href="../components/youtube-toolbar.html">
<!--<link rel="import" href="../components/video-viewer.html">
<link rel="import" href="../components/search-results.html">-->

<dom-module id="my-youtube">
  <template id="page-template">
    <custom-style>
      <style>
        :host {
          --app-primary-color: rgb(207, 29, 23);
          --app-secondary-color: black;
          display: block;
        }

        app-drawer-layout:not([narrow]) [drawer-toggle] {
          display: none;
        }

        app-toolbar {
          color: rgb(255, 255, 255);
          background-color: var(--app-primary-color);
        }

        app-toolbar ul {
          width: 100%;
          margin-bottom: 20px;
          padding: 10px 15px;
        }

        app-toolbar li {
          width: 49%;
          float: left;
          position: relative;
          display: block;
          margin-bottom: -1px;
        }

        app-header paper-icon-button {
          --paper-icon-button-ink-color: white;
        }

        paper-input {
          background-color: #6e9feb7d;
          margin-left: 2px;
        }

        app-drawer {
          z-index: 1
        }

        .drawer-list {
          margin: 0 20px;
        }

        .drawer-list a {
          display: block;
          padding: 0 16px;
          text-decoration: none;
          color: var(--app-secondary-color);
          line-height: 40px;
        }

        .drawer-list a.iron-selected {
          color: black;
          font-weight: bold;
        }

        app-header {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 212px;
          color: #fff;
          background-color: #3f51b5;
          /* https://bugs.chromium.org/p/chromium/issues/detail?id=637072 */
          --app-header-background-front-layer: {
            background-image: url(https://app-layout-assets.appspot.com/assets/bg1.jpg);
            background-position: left center;
          }
          ;
        }

        /*  paper-icon-button.top {
          background-color: #4385f4;
          --paper-icon-button-ink-color: white;
          position: absolute;
          top: 13px;
          left: 0px;
        }*/

        app-toolbar.tall {
          height: 148px;
        }

        sample-content {
          padding-top: 212px;
        }

        [main-title] {
          font-weight: lighter;
          margin-left: 108px;
        }

        [condensed-title] {
          font-weight: lighter;
          margin-left: 30px;
          overflow: hidden;
          text-overflow: ellipsis;
        }

        [condensed-title] i {
          font-weight: 100;
          font-style: normal;
        }

        @media (max-width: 639px) {
          [main-title] {
            margin-left: 50px;
            font-size: 30px;
          }
          [condensed-title] {
            font-size: 15px;
          }
        }

        :host([video-page-active]) {
          overflow: hidden;
        }

        :host([video-page-active]) iron-pages {
          transform: translateY(-170px);
        }

        iron-pages {
          transition: transform 0.3s;
        }

        search-results {
          display: block;
          padding: 4px 1px 1px 3px;
        }

        section {
          padding-top: 1px;
        }

        nav {
          width: 100%;
          height: 100px;
          background-color: gray;
          position: absolute;
          bottom: 0%;
          margin-top: 200px
        }

        app-drawer-layout:not([narrow]) [drawer-toggle] {
          display: none;
        }

        app-drawer {
          --app-drawer-content-container: {
            background-color: rgb(253, 250, 250);
            ;
          }
        }

        app-drawer.lower {
          top: 4em;
          /* position: relative; */
        }
      </style>
    </custom-style>
    <app-location route="{{route}}"></app-location>
    <!-- app-routes parse route paths based on the their `pattern`.
        Parameters are extracted into the `data` object. The rest of the path that
        comes after the `pattern` is put into the `tail` object, which can be
        passed to the `route` property of downstream app-routes. -->
    <app-route route="{{route}}" pattern="/:page" data="{{data}}"></app-route>
    <app-route route="{{route}}" pattern="/search" tail="{{searchTail}}"></app-route>
    <app-route route="{{route}}" pattern="/channels" tail="{{channelsTail}}"></app-route>
    <app-route route="{{route}}" pattern="/video" tail="{{videoTail}}" active="{{videoPageActive}}"></app-route>

    <app-drawer-layout>
      <app-drawer id="drawer" slot="drawer">
        <youtube-toolbar collapsed$="{{videoPageActive}}">
          <youtube-search route="[[searchTail]]" api="[[list]]" hide="false" search="[[dataq]]" video-data="{{videoData}}">
          </youtube-search>
        </youtube-toolbar>
        <!--google-signin class="right" brand="google" client-id="637872775110-m6bs42r7jrr0kuq4vkpqig7qf60dgpl0.apps.googleusercontent.com">
                <b hidden id="not-signed-in">Not signed in!</b>
              </google-signin-->
        <iron-selector selected="[[page]]" attr-for-selected="name" class="drawer-list" role="navigation">
          <a name="home">Profile</a>
          <a name="Search">Search</a>
          <a name="login">Channel</a>
          <a name="youtube">Favorites</a>
        </iron-selector>
      </app-drawer>
      <youtube-search route="[[channelsTail]]" api="[[channel]]" hide="true" video-data="{{videoData}}">
      </youtube-search>
      </app-header>
      <iron-pages selected="{{page}}" attr-for-selected="name" fallback-selection="view404" role="main">
        <page-video name="video" id="video" route="{{videoTail}}">
        </page-video>
        <page-search name="search" id="search" items="{{videos}}">
        </page-search>
      </iron-pages>
    </app-drawer-layout>

    <!--code>google-signin-offline</code> events:
    <span>{{offlineCode}}</span>
    </p>
    <p>Only display "not signed in" element after auth state is initialized (avoid flickering):
      <b hidden id="not-signed-in">Not signed in!</b>
    </p>
    <p>
      <button on-click="disconnect">Disconnect to start over</button>
    </p-->
    <!--google-signin-aware scopes="{{scope}}" openid-prompt="{{openidPromptValue}}" initialized="{{initialized}}" signed-in="{{signedIn}}"
      offline="{{offline}}" is-authorized="{{isAuthorized}}" need-additional-auth="{{needAdditionalAuth}}" on-google-signin-aware-error="handleSignInError"
      on-google-signin-aware-success="handleSignIn" on-google-signin-offline-success="handleOffline" on-google-signin-aware-signed-out="handleSignOut"
      on-signed-in-changed="handleStateChange" on-initialized-changed="handleStateChange">
    </google-signin-aware-->
  </template>
  <script>
    class pageYoutube extends Polymer.Element {
      static get is() {
        return 'my-youtube';
      }

      constructor() {
        super();
      }

      static get properties() {
        return {
          page: {
            type: String,
            reflectToAttribute: true,
            observer: '_pageChanged',
            notify: true
          },
          route: {
            type: Object,
            notify: true
          },
          routePage: {
            type: Object
          },

          videoData: {
            type: Object,
            observer: '_videoDataChanged',
          },

          videoPageActive: {
            type: Boolean,
            reflectToAttribute: true,
            observer: '_videoPageActiveChanged'
          },

          searchTail: {
            type: Object,
            notify: true
          },

          channelsTail: {
            type: Object,
            notify: true
          },

          videoTail: {
            type: Object,
            notify: true
          },

          newCategory: {
            type: String
          },

          videos: {
            type: Array,
            value: function () {
              return [];
            },
            notify: true
          },
          resize: {
            type: Boolean,
            observer: '_messenger'
          },
          dataq: {
            type: String,
            value: "zen",
            notify: true
          },
          time: {
            type: String,
            notify: true
          },
          data: {
            type: Object,
            value: function () {
              return {
                page: '/search/'
              };
            }
          },
          channel: {
            type: Object,
            value: function () {
              return {
                method: "channel",
                api: "search",
                type: "video"
              }
            }
          },
          list: {
            type: Object,
            value: function () {
              return {
                method: "search",
                api: "search",
                type: "video"
              }
            }
          }
        }
      };

      static get observers() {
        return [
          '_routePageChanged(data.page)',
        ];
      }

      attached() {
        // If we do not have an initial URL, we redirect to /search
        if (!this.route || !this.route.path) {
          this.set('route.path', '/search/');
        }
      }
      _messenger(data) {
        console.log("got", data)
        this.$.video.resize = data
      }
      _videoDataChanged(data) {
        var allVideos = [];
        var that = this;
        if (data)
          console.log(data)
        data.items.forEach(function (videoItem) {
          var youtubeVideo = {
            id: videoItem.id.videoId,
            title: videoItem.snippet.title,
            shortTitle: that.removeBadCharacters(videoItem.snippet.title.toLocaleLowerCase()) + " ...!!",
            thumbnail: videoItem.snippet.thumbnails.medium.url,
            channelTitle: videoItem.snippet.channelTitle.toLocaleLowerCase(),
            channelId: videoItem.snippet.channelId,
            videoItem: videoItem
          };

          allVideos.push(youtubeVideo);
        })
        this.set('videos', allVideos);
      }

      removeBadCharacters(char) {
        let arr = char.split(" ")
        let arr2 = []
        arr.map(item => {
          arr2.push(item.match(/\w[A-z]*/))
        })
        return arr2.join(" ")
      }

      _routePageChanged(page) {
        this.page = page === "youtube" ? page = "search" : page;
       // this.set('route.path', '/' + page + '/');
      }

      _pageChanged(page) {
        this.page = page === "youtube" || page === "searchYouTube" ? page = "search" : page;
        var resolvedPageUrl = this.resolveUrl('../components/page-' + page + '.html');
        console.log(resolvedPageUrl)
        Polymer.importHref(
          resolvedPageUrl,
          null,
          null,
          true);
      }
      _videoPageActiveChanged(videoPageActive, previousValue) {
        // change color of page on page change
        var newColor;
        this.routePage = "videos"
        if (videoPageActive) {
          // black
          this.$.video.style.display = "block"
          newColor = 0;
        } else {
          // white
          newColor = 255;
          this.$.video.style.display = ""
        }

        document.body.style.backgroundColor = 'rgb(' + newColor + ',' + newColor +
          ',' + newColor + ')';
        this.$.video.style.zIndex = 1
        // on first load, set the color then allow color transition animations
        if (previousValue === undefined) {
          document.body.style.transition = 'background-color .2s linear';
          return;
        }
      }
    }
    window.customElements.define(pageYoutube.is, pageYoutube);
  </script>
</dom-module>